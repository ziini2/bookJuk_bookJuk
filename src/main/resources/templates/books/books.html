
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<title>전체/지점별 도서조회</title>

<!-- 구글폰트 -->
<link href="https://fonts.gstatic.com" rel="preconnect">
<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
	rel="stylesheet">

<!-- 사이드바 아이콘 -->
<link href="/images/common/bootstrap-icons/bootstrap-icons.css"
	rel="stylesheet">
<link href="/images/common/remixicon/remixicon.css" rel="stylesheet">

<!--부트스트랩 외부링크-->
<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- 부트스트랩 JS -->
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- Main CSS File -->
<link href="/css/common/style.css" rel="stylesheet">
<link href="/css/books/books.css" rel="stylesheet">

</head>

<body>
	<div th:replace="~{/fragment/header :: header2}"></div>
	<div th:replace="~{/fragment/sidebar :: sidebar2}"></div>


	<main id="main" class="main">
		<div class="pagetitle mb-3">
			<h1>전체/지점별 도서 조회</h1>
		</div>
		<div class="row g-3 align-items-center">
			<div class="col-md-9">
				<div class="d-flex gap-3">
					<!-- 대여 상태 -->
					<select class="form-select filter-item" name="rentalStatus"
						id="rentalStatus" onchange="applyFilters()">
						<option value="">대여상태</option>
						<option value="1" th:selected="${rentalStatus == '1'}">대여가능</option>
						<option value="0" th:selected="${rentalStatus == '0'}">대여불가</option>
					</select>


					<!-- 지점 선택 -->
					<select class="form-select filter-item" name="storeCode"
						id="storeFilter" onchange="applyFilters()">
						<option value="">지점선택</option>
						<option th:each="store : ${storeList}"
							th:value="${store.storeCode}" th:text="${store.storeName}"
							th:selected="${storeCode != null and storeCode.equals(store.storeCode)}"></option>
					</select>

					<!-- 검색 -->
					<form id="searchForm" style="flex: 1;"
						onsubmit="applyFilters(); return false;">
						<div class="input-group">
							<input type="text" name="search" class="form-control filter-item"
								id="search" placeholder="도서명/작가명 검색" th:value="${search}">
							<button type="button" class="btn btn-success"
								onclick="applyFilters()">검색</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- 도서 테이블 -->
		<div class="table-responsive">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>도서번호</th>
						<th>ISBN</th>
						<th>도서명</th>
						<th>저자</th>
						<th>출판사</th>
						<th>출판일</th>
						<th>입고일</th>
						<th>대여현황</th>
						<th>도서상태</th>
						<th>대여금액</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="book : ${bookList.content}"
						onclick="showBookDetails(this)">
						<td th:text="${book.booksId}" data-book-id="${book.booksId}"></td>
						<td th:text="${book.isbn}" data-isbn="${book.isbn}"></td>
						<td th:text="${book.bookName}" data-book-name="${book.bookName}"></td>
						<td th:text="${book.author}" data-author="${book.author}"></td>
						<td th:text="${book.publish}" data-publish="${book.publish}"></td>
						<td th:text="${#temporals.format(book.publishDate, 'yyyy-MM-dd')}"
							data-publish-date="${#temporals.format(book.publishDate, 'yyyy-MM-dd')}"></td>
						<td
							th:text="${#temporals.format(book.bookDate, 'yyyy-MM-dd HH:mm:ss')}"
							data-book-date="${#temporals.format(book.bookDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
						<td><span th:text="${book.rentStatus ? '가능' : '불가'}"
							data-rent-status="${book.rentStatus ? '가능' : '불가'}"></span></td>
						<td th:text="${book.bookStatus.name()}"
							data-book-status="${book.bookStatus.name()}"></td>
						<td th:text="${book.rentMoney}"
							data-rent-money="${book.rentMoney}"></td>
					</tr>
					<tr th:if="${#lists.isEmpty(bookList.content)}">
						<td colspan="11" class="text-center">등록된 도서가 없습니다.</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- 페이지네이션 -->
		<div class="pagination-container d-flex justify-content-center mt-4">
			<nav aria-label="Page navigation example">
				<ul class="pagination pagination-success mb-0">
					<!-- 이전 페이지 -->
					<li class="page-item"
						th:classappend="${currentPage == 0} ? 'disabled'"><a
						class="page-link"
						th:href="@{/admin/books(page=${currentPage - 1}, size=${pageSize}, search=${search}, rentalStatus=${rentalStatus}, storeCode=${storeCode})}">
							이전 </a></li>

					<!-- 페이지 번호 -->
					<li class="page-item"
						th:each="i : ${#numbers.sequence((startPage ?: 0) + 1, (endPage ?: 0) + 1)}"
						th:classappend="${currentPage + 1 == i} ? 'active'"><a
						class="page-link"
						th:href="@{/admin/books(page=${i - 1}, size=${pageSize}, search=${search}, rentalStatus=${rentalStatus}, storeCode=${storeCode})}"
						th:text="${i}"></a></li>

					<!-- 다음 페이지 -->
					<li class="page-item"
						th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
						<a class="page-link"
						th:href="@{/admin/books(page=${currentPage + 1}, size=${pageSize}, search=${search}, rentalStatus=${rentalStatus}, storeCode=${storeCode})}">
							다음 </a>
					</li>
				</ul>
			</nav>
		</div>



		<!-- 도서 등록 및 수정 버튼 -->
		<div class="d-grid gap-2 d-md-block">
			<button type="button" class="btn btn-success" data-bs-toggle="modal"
				data-bs-target="#exampleModal" data-bs-whatever="@mdo">
				도서등록</button>
			<!-- 			<a class="btn btn-success" th:href="@{/admin/addBook}" role="button">도서등록</a> -->
			<!-- 			<a class="btn btn-secondary" th:href="@{/updateBook}" role="button">도서정보수정</a> -->
		</div>

		<!-- 도서등록 모달 -->
		<div class="modal fade" id="exampleModal" tabindex="-1"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">도서 등록</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form method="post" id="addBook">
							<!-- 이미지와 기본 정보 영역 -->
							<div class="d-flex">
								<!-- 도서 이미지 -->
								<div class="me-4">
									<div class="card" style="width: 150px;">
										<img id="bookImage" alt="도서 이미지" class="card-img-top"
											name="bookImage" src="/images/books/noimage.png"
											style="width: 150px; height: 200px; object-fit: contain; border: 1px solid #ccc;">
										<input type="hidden" id="bookImage" name="bookImage">
									</div>
								</div>

								<!-- 입력 필드들 -->
								<div style="flex: 1;">
									<!-- ISBN -->
									<div class="mb-3 d-flex align-items-center">
										<label for="isbn" class="col-form-label me-2"
											style="width: 80px;">ISBN</label>
										<div class="input-group" style="flex: 1;">
											<input type="text" class="form-control" id="isbn" name="isbn"
												readonly="readonly">
											<button type="button" class="btn btn-dark"
												onclick="isbnSearch()">조회</button>
										</div>
									</div>

									<!-- 도서명과 저자 -->
									<div class="row mb-3" style="align-items: center;">
										<div class="col-md-6 d-flex align-items-center">
											<label for="bookName" class="col-form-label me-2"
												style="width: 80px;">도서명</label> <input type="text"
												class="form-control" id="bookName" name="bookName"
												readonly="readonly">
										</div>
										<div class="col-md-6 d-flex align-items-center">
											<label for="author" class="col-form-label me-2"
												style="width: 80px;">저자</label> <input type="text"
												class="form-control" id="author" name="author"
												readonly="readonly">
										</div>
									</div>

									<!-- 출판사와 출판일 -->
									<div class="row mb-3">
										<div class="col-md-6 d-flex align-items-center">
											<label for="publish" class="col-form-label me-2"
												style="width: 80px;">출판사</label> <input type="text"
												class="form-control" id="publish" name="publish"
												readonly="readonly">
										</div>
										<div class="col-md-6 d-flex align-items-center">
											<label for="publishDate" class="col-form-label me-2"
												style="width: 80px;">출판일</label> <input type="text"
												class="form-control" id="publishDate" name="publishDate"
												readonly="readonly">
										</div>
									</div>
									<!-- 책소개 바로 위치 -->
									<div class="mb-3">
										<label for="story" class="col-form-label">책소개</label>
										<textarea class="form-control" id="story" name="story"
											rows="3"></textarea>
									</div>
								</div>
							</div>

							<!-- 장르ID와 입고일 -->
							<div class="row mb-3">
								<div class="col-md-6">
									<label for="genreId" class="col-form-label">장르ID</label> <select
										class="form-control" id="genreId" name="genreId">
										<option value="" disabled selected>장르를 선택하세요</option>
										<th:block th:each="genre : ${genreList}">
											<option th:value="${genre.genreId}"
												th:text="${genre.genreName}"></option>
										</th:block>
									</select>
								</div>
								<div class="col-md-6">
									<label for="bookDate" class="col-form-label">입고일</label> <input
										type="date" class="form-control" id="bookDate" name="bookDate"
										readonly="readonly">
								</div>
							</div>

							<!-- 지점ID와 대여금액 -->
							<div class="row mb-3">
								<div class="col-md-6">
									<label for="storeCode" class="col-form-label">지점ID</label> <select
										class="form-select" name="storeCode" id="storeCode">
										<option value="" disabled selected>지점 선택</option>
										<option th:each="store : ${storeList}"
											th:value="${store.storeCode}" th:text="${store.storeName}"></option>
									</select>
								</div>
								<div class="col-md-6">
									<label for="rentMoney" class="col-form-label">대여금액</label> <input
										type="text" class="form-control" name="rentMoney"
										id="rentMoney" placeholder="금액 입력">
								</div>
							</div>

							<!-- 도서상태 -->
							<input type="hidden" name="bookStatus" id="bookStatus"
								value="GOOD">
						</form>
					</div>

					<div class="modal-footer">
						<button type="reset" class="btn btn-secondary"
							data-bs-dismiss="modal">초기화</button>
						<button type="button" class="btn btn-primary"
							onclick="registerBook()">등록하기</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 모달로 정보 수정하기 -->
		<!-- Modal -->
		<div class="modal fade" id="updateBookModal" tabindex="-1"
			aria-labelledby="updateBookModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="updateBookModalLabel">도서 수정</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<form id="updateBookForm" action="/admin/books/update" method="post">
						<div class="modal-body">
							<!-- Hidden Book ID -->
							<input type="hidden" id="updateBookId" name="booksId">

							<!-- ISBN -->
							<div class="mb-3">
								<label for="updateISBN" class="form-label">ISBN</label> <input
									type="text" class="form-control" id="updateISBN" name="isbn"
									readonly>
							</div>

							<!-- 도서명 -->
							<div class="mb-3">
								<label for="updateBookName" class="form-label">도서명</label> <input
									type="text" class="form-control" id="updateBookName"
									name="bookName">
							</div>

							<!-- 저자 -->
							<div class="mb-3">
								<label for="updateAuthor" class="form-label">저자</label> <input
									type="text" class="form-control" id="updateAuthor"
									name="author">
							</div>

							<!-- 출판사 -->
							<div class="mb-3">
								<label for="updatePublish" class="form-label">출판사</label> <input
									type="text" class="form-control" id="updatePublish"
									name="publish">
							</div>

							<!-- 출판일 -->
							<div class="mb-3">
								<label for="updatePublishDate" class="form-label">출판일</label> <input
									type="date" class="form-control" id="updatePublishDate"
									name="publishDate">
							</div>

							<!-- 도서상태 -->
							<div class="mb-3">
								<label for="updateBookStatus" class="form-label">도서상태</label> <select
									class="form-select" id="updateBookStatus" name="bookStatus">
									<option value="GOOD">양호</option>
									<option value="DISCARD">폐기</option>
									<option value="LOST">분실</option>
									<option value="STOLEN">도난</option>
								</select>
							</div>

							<!-- 대여금액 -->
							<div class="mb-3">
								<label for="updateRentMoney" class="form-label">대여금액</label> <input
									type="number" class="form-control" id="updateRentMoney"
									name="rentMoney">
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">닫기</button>
							<button type="button" class="btn btn-primary"
								id="saveChangesButton">저장</button>
						</div>
					</form>
				</div>
			</div>
		</div>

	</main>

	<!-- End main -->

	<!-- 사이드바 열었다 닫았다 하는거 -->
	<script th:src="@{/js/common/main.js}"></script>
	<script th:src="@{/js/books/addBook.js}"></script>
	<script th:src="@{/js/books/bookSearch.js}"></script>
	<script th:src="@{/js/books/updateBook.js}"></script>

</body>
</html>
