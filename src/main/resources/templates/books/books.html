<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<title>전체/지점별 도서조회</title>

<!-- 구글폰트 -->
<link href="https://fonts.gstatic.com" rel="preconnect">
<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
	rel="stylesheet">

<!-- 사이드바 아이콘 -->
<link href="/images/common/bootstrap-icons/bootstrap-icons.css"
	rel="stylesheet">
<link href="/images/common/remixicon/remixicon.css" rel="stylesheet">

<!--부트스트랩 외부링크-->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<!-- Main CSS File -->
<link href="/css/common/style.css" rel="stylesheet">
<!-- <link href="/css/books/books.css" rel="stylesheet"> -->

</head>

<body>
	<div th:replace="~{/fragment/header :: header2}"></div>
	<div th:replace="~{/fragment/sidebar :: sidebar2}"></div>


	<main id="main" class="main">
		<div class="pagetitle mb-3">
			<div class="row g-3 align-items-center">
				<!-- 제목 -->
				<div class="col-auto">
					<h1>전체/지점별 도서 조회</h1>
				</div>

				<!-- 입력 그룹 -->
				<div class="col-md-9">
					<div class="d-flex gap-3 mb-3">
						<div class="input-group mb-3">
							<!-- 대여상태 드롭다운 -->
							<select class="form-select" name="rentalStatus"
								style="max-width: 120px;">
								<option selected>대여상태</option>
								<option value="1">대여가능</option>
								<option value="2">대여불가</option>
							</select>


							<!-- 지점선택 드롭다운 -->
							<select class="form-select" name="storeName"
								style="max-width: 120px;">
								<option selected>지점선택</option>
								<option value="1">부전점</option>
								<option value="2">해운대점</option>
								<option value="3">양정점</option>
								<option value="4">강남점</option>
							</select>

							<!-- 도서찾기 텍스트 -->
							<span class="input-group-text">도서찾기</span>
							<!-- 검색어 입력 필드 -->
							<input type="text" class="form-control" id="myinput"
								placeholder="검색어를 입력하세요" style="max-width: 200px;">
							<!-- 검색 버튼 -->
							<button type="button" class="btn btn-secondary"
								style="max-width: 100px;">검색</button>

						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- 테이블 -->
		<div class="table-responsive mt-4">
			<table class="table datatable">
				<thead>
					<tr>
						<th>도서번호</th>
						<th>ISBN번호</th>
						<th>도서명</th>
						<th>저자</th>
						<th>출판사</th>
						<th>출판일</th>
						<th>입고일</th>
						<th>대여현황</th>
						<th>도서상태</th>
						<th>재고</th>
						<th>대여금액</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="bookInfo, status:${bookList}">
						<td th:text="${bookInfo.bookNum}"></td>
						<td th:text="${bookInfo.ISBN}"></td>
						<td th:text="${bookInfo.bookName}"></td>
						<td th:text="${bookInfo.author}"></td>
						<td th:text="${bookInfo.publish}"></td>
						<td th:text="${bookInfo.publishDate}"></td>
						<td th:text="${books.bookDate}"></td>
						<td th:text="${books.rentStatus}"></td>
						<td th:text="${books.bookStatus}"></td>
						<td th:text="${books.inventory}"></td>
						<td th:text="${books.rentMoney}"></td>

						<td>
							<!--재고 조정버튼-->
							<div class="d-flex align-items-center">
								<button type="button" class="btn btn-outline-secondary btn-sm"
									onclick='count("minus", 1)'>
									<i class="ri-subtract-line" style="font-size: 0.75rem;"></i>
								</button>
								<div id="result-1" class="mx-2">0</div>
								<button type="button" class="btn btn-outline-secondary btn-sm"
									onclick='count("plus", 1)'>
									<i class="ri-add-fill" style="font-size: 0.75rem;"></i>
								</button>
							</div>
						</td>
						<td>
							<button type="button" class="btn btn-outline-warning">상세보기</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- 도서 등록 및 수정 버튼 -->
		<div class="d-grid gap-2 d-md-block">
			<button type="button" 
					class="btn btn-primary" 
					data-bs-toggle="modal" 
					data-bs-target="#exampleModal" 
					data-bs-whatever="@mdo">
					도서등록
			</button>
			<!-- 			<a class="btn btn-success" th:href="@{/admin/addBook}" role="button">도서등록</a> -->
			<a class="btn btn-success" th:href="@{/updateBook}" role="button">도서정보수정</a>
		</div>
		<!-- 도서등록 모달 -->
		<div class="modal fade" id="exampleModal" tabindex="-1"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg" >
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" 
							id="exampleModalLabel">
							도서 등록
						</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form method="post" id="addBook">
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">ISBN
									번호</label>
								<div class="d-flex" style="gap: 10px;">
									<input type="text" class="form-control" id="recipient-name"
										name="isbn">
									<button type="button" class="btn btn-primary"
										onclick="isbnSearch()">조회</button>
								</div>
							</div>

							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">도서명</label>
								<input type="text" class="form-control" id="recipient-name" name="bookName">
							</div>
							
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">저자</label>
								<input type="text" class="form-control" id="recipient-name" name="author">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">출판사</label>
								<input type="text" class="form-control" id="recipient-name" name="publish">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">출판일</label>
								<input type="text" class="form-control" id="recipient-name" name="publishDate">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">줄거리</label>
								<input type="text" class="form-control" id="recipient-name" name="story">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">장르ID</label>
								<input type="text" class="form-control" id="recipient-name" name="genreId">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">입고일</label>
								<input type="text" class="form-control" id="recipient-name" name="bookDate">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">수량</label>
								<input type="text" class="form-control" id="recipient-name" name="inventory">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">지점ID</label>
								<select class="form-select"
									name="storeCode" style="max-width: 150px;">
									<option selected>지점선택</option>
								</select>
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">대여금액</label>
								<input type="text"
								   class="form-control" 
								   name="rentalPrice" 
								   id="rentPrice"
								   placeholder="금액입력" 
								   style="max-width: 150px;">
							</div>
							
							<div class="mb-3">
								<label for="message-text" class="col-form-label">도서상태</label>
								<select
								class="form-select" name="bookStatus"
								style="max-width: 250px;">
								<option selected>도서 상태를 선택하세요</option>
								<option value="good">양호</option>
								<option value="bad">불량</option>
								<option value="discard">폐기</option>
								<option value="lost">분실</option>
							</select>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="reset" class="btn btn-secondary"
							data-bs-dismiss="modal">초기화</button>
						<button type="button" class="btn btn-primary">등록하기</button>
					</div>
				</div>
			</div>
		</div>
	</main>


	<!-- End main -->
<script>
	function isbnSearch(){
		//querySelector로 input 을 선택할 수 있고 value 로 값을 가져올수 있다.
		const isbn = document.querySelector("input[name='isbn']").value;
		//문자열을 합칠땐 템플릿 리터럴(``)로 감싸야한다. 그래야 isbn 변수가 들어간다.
		let url = `https://www.nl.go.kr/seoji/SearchApi.do?cert_key=6e3c1f31ab8b477b3346a6d485a280dcebfbdd9f97fe34c373133551f4fc8616&result_style=json&page_no=1&page_size=1&isbn=${isbn}`
	
	
	//fetch 를 사용하여 JSON 데이터를 요청하고, 응답을 처리
	fetch(url)
		.then(response => {
			if(!response.ok){
				throw new Error(response.statusText);
			}
			return response.json();
			
		})
		// 여기서 응답을 받는다. -> 원하는 데이터 추출
		.then(data => {
			console.log(data);
			// 콘솔 확인시 docs 에 정보가 들어있다.
			
			//dosc[0] 은 배열의 첫 번째 객체를 가르킨다. 콘솔에 "0:"
			//const {AUTHOR, TITLE} 는 필요한 필드를 구조 분해 할당으로 한 번에 가져오는 방법
			const {EA_ISBN, TITLE, AUTHOR,BOOK_SUMMARY_URL, INPUT_DATE} = data.docs[0];
			
			//'value = ' 형태로 값을 넣을 수도 있다.
			//document.querySelector("input[name= 'isbn']").value = EA_ISBN;
			document.querySelector("input[name= 'bookName']").value = TITLE;
			document.querySelector("input[name= 'author']").value = AUTHOR;
			document.querySelector("input[name= 'story']").value = BOOK_SUMMARY_URL;
			document.querySelector("input[name= 'publishDate']").value = INPUT_DATE;
			//document.querySelector("input[name= 'author']").value = TITLE_URL;
			//document.querySelector("input[name= 'author']").value = SUBJECT;
			
			
		})
		.catch(error =>{
			console.error(error);
		})
		
	}

	</script>
	<script>
		document.getElementById('sidebarToggle').addEventListener('click',
				function() {
					const sidebar = document.getElementById('sidebar');
					sidebar.classList.toggle('active'); // 'active' 클래스가 사이드바 열기/닫기 상태를 관리
				});
	</script>
	<!-- 사이드바 열었다 닫았다 하는거 -->
	<script th:src="@{/js/common/main.js}"></script>
</body>
</html>
